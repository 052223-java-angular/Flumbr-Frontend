<mat-card class="bg-amber-50">
  <mat-card-header>
    <div class="flex justify-between w-full">
      <div class="flex gap-4 cursor-pointer" (click)="navigateToUser(post.userId)">
        <div mat-card-avatar class="bg-cover" style="background-image: url({{post.profileImg}});"
          *ngIf="post.profileImg"></div>
        <div mat-card-avatar class="flex justify-center items-center bg-indigo-950"><mat-icon
            class="text-green-50">person</mat-icon></div>
        <mat-card-title>{{post.username}}</mat-card-title>
      </div>

      <div>

        <button mat-icon-button [matMenuTriggerFor]="menu" matTooltip="Options" matTooltipClass="tooltip"
          matTooltipPosition="above"><mat-icon class="icon">more_horiz</mat-icon></button>
        <mat-menu #menu="matMenu">
          <div mat-menu-item>
            <p class="text-sm">{{post.createTime}}</p>
          </div>
          <div mat-menu-item *ngIf="post.editTime">
            <p class="text-sm">{{post.editTime}}</p>
          </div> 
          
          <!-- follow / unfollow  -->
          <!-- {{post | json}} -->
          <ng-container *ngIf="isFollowingUsernames">
            <app-follow 
              viewTemplate="textView" 
              [isFollowingUsernames]="isFollowingUsernames"
              [followIdentity]="{
                loggedInUserId: 'this should be the logged in user id', 
                ownerUserId: post.id, 
                ownerUsername: post.username}"></app-follow>
          </ng-container>


          <button mat-menu-item>
            <span (click)="reportPost(post.id)" class="font-medium text-red-600">Report</span>
          </button>
        </mat-menu>
      </div>


    </div>
  </mat-card-header>
  <img mat-card-image src="{{post.s3Url}}" alt="Photo of a Shiba Inu" *ngIf="post.mediaType == 'image/jpeg'">
  <video *ngIf="post.mediaType == 'video/mp4'" controls>
    <source [src]="post.s3Url" type="video/mp4">
    <source [src]="post.s3Url" type="video/ogg">
    Your browser does not support the video tag.
  </video>
  <mat-card-content>
    <p class="!mt-3" *ngIf="post.message">
      {{post.message}}
    </p>
  </mat-card-content>
  <mat-card-footer>
    <ul class="m-4 flex gap-2 flex-wrap">
      <li class="cursor-pointer" *ngFor="let tag of post.tags" (click)="navigateToTag(tag.id)">
        #{{tag.name}}
      </li>
    </ul>
  </mat-card-footer>
  <mat-card-actions class="flex justify-between">
    <div class="flex gap-4">
      <mat-icon class="icon" matTooltip="Like" matTooltipClass="tooltip" matTooltipPosition="above"
        (click)="likePost(post.id)">thumb_up</mat-icon>
      <mat-icon class="icon" matTooltip="Dislike" matTooltipClass="tooltip" matTooltipPosition="above"
        (click)="dislikePost(post.id)">thumb_down</mat-icon>
    </div>
    <div class="flex gap-4">
      <mat-icon class="icon" matTooltip="Share" matTooltipClass="tooltip" matTooltipPosition="above"
        (click)="sharePost()">share</mat-icon>
      <mat-icon class="icon" matTooltip="Comment" matTooltipClass="tooltip" matTooltipPosition="above"
        (click)="toggleChat()">chat</mat-icon>
    </div>
  </mat-card-actions>
  <div *ngIf="isChatOpen">
    <mat-divider></mat-divider>
    <ul class="flex flex-col p-4 gap-3">
      <li class="flex gap-3" *ngFor="let comment of post.comments">
        <div mat-card-avatar class="m-0 bg-cover"
          style="background-image: url('https://images.unsplash.com/photo-1517849845537-4d257902454a?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=435&q=80');">
        </div>
        <div class="flex flex-col gap-2 p-2 border-[1px] border-solid border-slate-700 rounded-lg">
          <p class="m-0 font-semibold">{{comment.username}}</p>
          <p class="m-0">{{comment.comment}}</p>
        </div>
      </li>
    </ul>
  </div>
</mat-card>